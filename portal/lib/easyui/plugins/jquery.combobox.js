!function(o){function e(e,t){var i=o.data(e,"combobox");return o.easyui.indexOfArray(i.data,i.options.valueField,t)}function t(e,t){var i=o.data(e,"combobox").options,n=o(e).combo("panel"),a=i.finder.getEl(e,t);if(a.length)if(a.position().top<=0){var r=n.scrollTop()+a.position().top;n.scrollTop(r)}else if(a.position().top+a.outerHeight()>n.height()){var r=n.scrollTop()+a.position().top+a.outerHeight()-n.height();n.scrollTop(r)}n.triggerHandler("scroll")}function i(e,t){var i=o.data(e,"combobox").options,a=o(e).combobox("panel"),r=a.children("div.combobox-item-hover");r.length||(r=a.children("div.combobox-item-selected")),r.removeClass("combobox-item-hover");var s="div.combobox-item:visible:not(.combobox-item-disabled):first",l="div.combobox-item:visible:not(.combobox-item-disabled):last";if(r.length?"next"==t?(r=r.nextAll(s),r.length||(r=a.children(s))):(r=r.prevAll(s),r.length||(r=a.children(l))):r=a.children("next"==t?s:l),r.length){r.addClass("combobox-item-hover");var c=i.finder.getRow(e,r);c&&(o(e).combobox("scrollTo",c[i.valueField]),i.selectOnNavigation&&n(e,c[i.valueField]))}}function n(e,t,i){var n=o.data(e,"combobox").options,a=o(e).combo("getValues");-1==o.inArray(t+"",a)&&(n.multiple?a.push(t):a=[t],r(e,a,i))}function a(e,t){var i=(o.data(e,"combobox").options,o(e).combo("getValues")),n=o.inArray(t+"",i);n>=0&&(i.splice(n,1),r(e,i))}function r(e,t,i){var n=o.data(e,"combobox").options,a=o(e).combo("panel");o.isArray(t)||(t=t.split(n.separator)),n.multiple||(t=t.length?[t[0]]:[""]);var r=o(e).combo("getValues");a.is(":visible")&&a.find(".combobox-item-selected").each(function(){var t=n.finder.getRow(e,o(this));t&&-1==o.easyui.indexOfArray(r,t[n.valueField])&&o(this).removeClass("combobox-item-selected")}),o.map(r,function(i){if(-1==o.easyui.indexOfArray(t,i)){var a=n.finder.getEl(e,i);a.hasClass("combobox-item-selected")&&(a.removeClass("combobox-item-selected"),n.onUnselect.call(e,n.finder.getRow(e,i)))}});for(var s=null,l=[],c=[],b=0;b<t.length;b++){var u=t[b],d=u,m=n.finder.getRow(e,u);if(m){d=m[n.textField],s=m;var h=n.finder.getEl(e,u);h.hasClass("combobox-item-selected")||(h.addClass("combobox-item-selected"),n.onSelect.call(e,m))}l.push(u),c.push(d)}if(i||o(e).combo("setText",c.join(n.separator)),n.showItemIcon){var f=o(e).combobox("textbox");f.removeClass("textbox-bgicon "+n.textboxIconCls),s&&s.iconCls&&(f.addClass("textbox-bgicon "+s.iconCls),n.textboxIconCls=s.iconCls)}o(e).combo("setValues",l),a.triggerHandler("scroll")}function s(e,t,i){var n=o.data(e,"combobox"),a=n.options;n.data=a.loadFilter.call(e,t),n.data=o.map(n.data,function(o){return o[a.valueField]=o[a.valueField]+"",o}),a.view.render.call(a.view,e,o(e).combo("panel"),n.data);var s=o(e).combobox("getValues");o.easyui.forEach(n.data,!1,function(e){e["selected"]&&o.easyui.addArrayItem(s,e[a.valueField]+"")}),a.multiple?r(e,s,i):r(e,s.length?[s[s.length-1]]:[],i),a.onLoadSuccess.call(e,t)}function l(e,t,i,n){var a=o.data(e,"combobox").options;t&&(a.url=t),i=o.extend({},a.queryParams,i||{}),0!=a.onBeforeLoad.call(e,i)&&a.loader.call(e,i,function(o){s(e,o,n)},function(){a.onLoadError.apply(this,arguments)})}function c(e,t){function i(o){s.reversed?c.addClass("combobox-item-hover"):r(e,s.multiple?t?o:[]:o,!0)}var a=o.data(e,"combobox"),s=a.options,c=o(),b=s.multiple?t.split(s.separator):[t];if("remote"==s.mode)i(b),l(e,null,{q:t},!0);else{var u=o(e).combo("panel");u.find(".combobox-item-hover").removeClass("combobox-item-hover"),u.find(".combobox-item,.combobox-group").hide();var d=a.data,m=[];o.map(b,function(t){t=o.trim(t);var i=t,a=void 0;c=o();for(var r=0;r<d.length;r++){var l=d[r];if(s.filter.call(e,t,l)){var b=l[s.valueField],u=l[s.textField],h=l[s.groupField],f=s.finder.getEl(e,b).show();u.toLowerCase()==t.toLowerCase()&&(i=b,s.reversed?c=f:n(e,b,!0)),s.groupField&&a!=h&&(s.finder.getGroupEl(e,h).show(),a=h)}}m.push(i)}),i(m)}}function b(t){var i=o(t),n=i.combobox("options"),a=i.combobox("panel"),r=a.children("div.combobox-item-hover");if(r.length){r.removeClass("combobox-item-hover");var s=n.finder.getRow(t,r),l=s[n.valueField];n.multiple&&r.hasClass("combobox-item-selected")?i.combobox("unselect",l):i.combobox("select",l)}var c=[];o.map(i.combobox("getValues"),function(o){e(t,o)>=0&&c.push(o)}),i.combobox("setValues",c),n.multiple||i.combobox("hidePanel")}function u(e){var t=o.data(e,"combobox"),i=t.options;o(e).addClass("combobox-f"),o(e).combo(o.extend({},i,{onShowPanel:function(){o(this).combo("panel").find("div.combobox-item:hidden,div.combobox-group:hidden").show(),r(this,o(this).combobox("getValues"),!0),o(this).combobox("scrollTo",o(this).combobox("getValue")),i.onShowPanel.call(this)}}));var n=o(e).combo("panel");n.unbind(".combobox");for(var a in i.panelEvents)n.bind(a+".combobox",{target:e},i.panelEvents[a])}function d(e){o(this).children("div.combobox-item-hover").removeClass("combobox-item-hover");var t=o(e.target).closest("div.combobox-item");t.hasClass("combobox-item-disabled")||t.addClass("combobox-item-hover"),e.stopPropagation()}function m(e){o(e.target).closest("div.combobox-item").removeClass("combobox-item-hover"),e.stopPropagation()}function h(e){var t=o(this).panel("options").comboTarget;if(t){var i=o(t).combobox("options"),r=o(e.target).closest("div.combobox-item");if(r.length&&!r.hasClass("combobox-item-disabled")){var s=i.finder.getRow(t,r);if(s){i.blurTimer&&(clearTimeout(i.blurTimer),i.blurTimer=null),i.onClick.call(t,s);var l=s[i.valueField];i.multiple?r.hasClass("combobox-item-selected")?a(t,l):n(t,l):o(t).combobox("setValue",l).combobox("hidePanel"),e.stopPropagation()}}}}function f(e){var t=o(this).panel("options").comboTarget;if(t){var i=o(t).combobox("options");if("sticky"==i.groupPosition){var n=o(this).children(".combobox-stick");n.length||(n=o('<div class="combobox-stick"></div>').appendTo(this)),n.hide();var a=o(t).data("combobox");o(this).children(".combobox-group:visible").each(function(){var e=o(this),r=i.finder.getGroup(t,e),s=a.data[r.startIndex+r.count-1],l=i.finder.getEl(t,s[i.valueField]);if(e.position().top<0&&l.position().top>0)return n.show().html(e.html()),!1})}}}o.fn.combobox=function(e,t){if("string"==typeof e){var i=o.fn.combobox.methods[e];return i?i(this,t):this.combo(e,t)}return e=e||{},this.each(function(){var t=o.data(this,"combobox");if(t?o.extend(t.options,e):t=o.data(this,"combobox",{options:o.extend({},o.fn.combobox.defaults,o.fn.combobox.parseOptions(this),e),data:[]}),u(this),t.options.data)s(this,t.options.data);else{var i=o.fn.combobox.parseData(this);i.length&&s(this,i)}l(this)})},o.fn.combobox.methods={options:function(e){var t=e.combo("options");return o.extend(o.data(e[0],"combobox").options,{width:t.width,height:t.height,originalValue:t.originalValue,disabled:t.disabled,readonly:t.readonly})},cloneFrom:function(e,t){return e.each(function(){o(this).combo("cloneFrom",t),o.data(this,"combobox",o(t).data("combobox")),o(this).addClass("combobox-f").attr("comboboxName",o(this).attr("textboxName"))})},getData:function(e){return o.data(e[0],"combobox").data},setValues:function(o,e){return o.each(function(){r(this,e)})},setValue:function(e,t){return e.each(function(){r(this,o.isArray(t)?t:[t])})},clear:function(o){return o.each(function(){r(this,[])})},reset:function(e){return e.each(function(){var e=o(this).combobox("options");e.multiple?o(this).combobox("setValues",e.originalValue):o(this).combobox("setValue",e.originalValue)})},loadData:function(o,e){return o.each(function(){s(this,e)})},reload:function(e,t){return e.each(function(){if("string"==typeof t)l(this,t);else{if(t){o(this).combobox("options").queryParams=t}l(this)}})},select:function(o,e){return o.each(function(){n(this,e)})},unselect:function(o,e){return o.each(function(){a(this,e)})},scrollTo:function(o,e){return o.each(function(){t(this,e)})}},o.fn.combobox.parseOptions=function(e){o(e);return o.extend({},o.fn.combo.parseOptions(e),o.parser.parseOptions(e,["valueField","textField","groupField","groupPosition","mode","method","url",{showItemIcon:"boolean",limitToList:"boolean"}]))},o.fn.combobox.parseData=function(e){function t(e,t){var a=o(e),r={};r[n.valueField]=void 0!=a.attr("value")?a.attr("value"):a.text(),r[n.textField]=a.text(),r["selected"]=a.is(":selected"),r["disabled"]=a.is(":disabled"),t&&(n.groupField=n.groupField||"group",r[n.groupField]=t),i.push(r)}var i=[],n=o(e).combobox("options");return o(e).children().each(function(){if("optgroup"==this.tagName.toLowerCase()){var e=o(this).attr("label");o(this).children().each(function(){t(this,e)})}else t(this)}),i};var p=0,x={render:function(e,t,i){var n=o.data(e,"combobox"),a=n.options;p++,n.itemIdPrefix="_easyui_combobox_i"+p,n.groupIdPrefix="_easyui_combobox_g"+p,n.groups=[];for(var r=[],s=void 0,l=0;l<i.length;l++){var c=i[l],b=(c[a.valueField],c[a.textField]),u=c[a.groupField];u?s!=u?(s=u,n.groups.push({value:u,startIndex:l,count:1}),r.push('<div id="'+n.groupIdPrefix+"_"+(n.groups.length-1)+'" class="combobox-group">'),r.push(a.groupFormatter?a.groupFormatter.call(e,u):u),r.push("</div>")):n.groups[n.groups.length-1].count++:s=void 0;var d="combobox-item"+(c.disabled?" combobox-item-disabled":"")+(u?" combobox-gitem":"");r.push('<div id="'+n.itemIdPrefix+"_"+l+'" class="'+d+'">'),a.showItemIcon&&c.iconCls&&r.push('<span class="combobox-icon '+c.iconCls+'"></span>'),r.push(a.formatter?a.formatter.call(e,c):b),r.push("</div>")}o(t).html(r.join(""))}};o.fn.combobox.defaults=o.extend({},o.fn.combo.defaults,{valueField:"value",textField:"text",groupPosition:"static",groupField:null,groupFormatter:function(o){return o},mode:"local",method:"post",url:null,data:null,queryParams:{},showItemIcon:!1,limitToList:!1,view:x,keyHandler:{up:function(o){i(this,"prev"),o.preventDefault()},down:function(o){i(this,"next"),o.preventDefault()},left:function(o){},right:function(o){},enter:function(o){b(this)},query:function(o,e){c(this,o)}},inputEvents:o.extend({},o.fn.combo.defaults.inputEvents,{blur:function(e){var t=e.data.target,i=o(t).combobox("options");(i.reversed||i.limitToList)&&(i.blurTimer&&clearTimeout(i.blurTimer),i.blurTimer=setTimeout(function(){o(t).parent().length&&(i.reversed?o(t).combobox("setValues",o(t).combobox("getValues")):i.limitToList&&b(t),i.blurTimer=null)},50))}}),panelEvents:{mouseover:d,mouseout:m,click:h,scroll:f},filter:function(e,t){return t[o(this).combobox("options").textField].toLowerCase().indexOf(e.toLowerCase())>=0},formatter:function(e){return e[o(this).combobox("options").textField]},loader:function(e,t,i){var n=o(this).combobox("options");if(!n.url)return!1;o.ajax({type:n.method,url:n.url,data:e,dataType:"json",success:function(o){t(o)},error:function(){i.apply(this,arguments)}})},loadFilter:function(o){return o},finder:{getEl:function(t,i){var n=e(t,i),a=o.data(t,"combobox").itemIdPrefix+"_"+n;return o("#"+a)},getGroupEl:function(e,t){var i=o.data(e,"combobox"),n=o.easyui.indexOfArray(i.groups,"value",t),a=i.groupIdPrefix+"_"+n;return o("#"+a)},getGroup:function(e,t){var i=o.data(e,"combobox"),n=t.attr("id").substr(i.groupIdPrefix.length+1);return i.groups[parseInt(n)]},getRow:function(t,i){var n=o.data(t,"combobox"),a=i instanceof o?i.attr("id").substr(n.itemIdPrefix.length+1):e(t,i);return n.data[parseInt(a)]}},onBeforeLoad:function(o){},onLoadSuccess:function(o){},onLoadError:function(){},onSelect:function(o){},onUnselect:function(o){},onClick:function(o){}})}(jQuery);