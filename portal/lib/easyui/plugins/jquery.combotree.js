!function(e){function t(t){var r=e.data(t,"combotree"),i=r.options,a=r.tree;e(t).addClass("combotree-f"),e(t).combo(e.extend({},i,{onShowPanel:function(){i.editable&&a.tree("doFilter",""),i.onShowPanel.call(this)}}));var c=e(t).combo("panel");a||(a=e("<ul></ul>").appendTo(c),r.tree=a),a.tree(e.extend({},i,{checkbox:i.multiple,onLoadSuccess:function(o,c){var u=e(t).combotree("getValues");i.multiple&&e.map(a.tree("getChecked"),function(t){e.easyui.addArrayItem(u,t.id)}),n(t,u,r.remainText),i.onLoadSuccess.call(this,o,c)},onClick:function(n){i.multiple?e(this).tree(n.checked?"uncheck":"check",n.target):e(t).combo("hidePanel"),r.remainText=!1,o(t),i.onClick.call(this,n)},onCheck:function(e,n){r.remainText=!1,o(t),i.onCheck.call(this,e,n)}}))}function o(t){var o=e.data(t,"combotree"),r=o.options,i=o.tree,a=[];if(r.multiple)a=e.map(i.tree("getChecked"),function(e){return e.id});else{var c=i.tree("getSelected");c&&a.push(c.id)}a=a.concat(r.unselectedValues),n(t,a,o.remainText)}function n(t,o,n){function r(t,o){var n=e.easyui.getArrayItem(o,"id",t);return n?i(n):void 0}function i(e){return e[c.textField||""]||e.text}var a=e.data(t,"combotree"),c=a.options,u=a.tree,s=u.tree("options"),l=s.onBeforeCheck,d=s.onCheck,m=s.onSelect;s.onBeforeCheck=s.onCheck=s.onSelect=function(){},e.isArray(o)||(o=o.split(c.separator)),c.multiple||(o=o.length?[o[0]]:[""]);var f=e.map(o,function(e){return String(e)});u.find("div.tree-node-selected").removeClass("tree-node-selected"),e.map(u.tree("getChecked"),function(t){-1==e.inArray(String(t.id),f)&&u.tree("uncheck",t.target)});var h=[];if(c.unselectedValues=[],e.map(f,function(e){var t=u.tree("find",e);t?(u.tree("check",t.target).tree("select",t.target),h.push(i(t))):(h.push(r(e,c.mappingRows)||e),c.unselectedValues.push(e))}),c.multiple&&e.map(u.tree("getChecked"),function(t){var o=String(t.id);-1==e.inArray(o,f)&&(f.push(o),h.push(i(t)))}),s.onBeforeCheck=l,s.onCheck=d,s.onSelect=m,!n){var p=h.join(c.separator);e(t).combo("getText")!=p&&e(t).combo("setText",p)}e(t).combo("setValues",f)}function r(t,o){var n=e.data(t,"combotree"),r=n.options,i=n.tree;n.remainText=!0,i.tree("doFilter",r.multiple?o.split(r.separator):o)}function i(t){e.data(t,"combotree").remainText=!1,e(t).combotree("setValues",e(t).combotree("getValues")),e(t).combotree("hidePanel")}e.fn.combotree=function(o,n){if("string"==typeof o){var r=e.fn.combotree.methods[o];return r?r(this,n):this.combo(o,n)}return o=o||{},this.each(function(){var n=e.data(this,"combotree");n?e.extend(n.options,o):e.data(this,"combotree",{options:e.extend({},e.fn.combotree.defaults,e.fn.combotree.parseOptions(this),o)}),t(this)})},e.fn.combotree.methods={options:function(t){var o=t.combo("options");return e.extend(e.data(t[0],"combotree").options,{width:o.width,height:o.height,originalValue:o.originalValue,disabled:o.disabled,readonly:o.readonly})},clone:function(t,o){var n=t.combo("clone",o);return n.data("combotree",{options:e.extend(!0,{},t.combotree("options")),tree:t.combotree("tree")}),n},tree:function(t){return e.data(t[0],"combotree").tree},loadData:function(t,o){return t.each(function(){e.data(this,"combotree").options.data=o,e.data(this,"combotree").tree.tree("loadData",o)})},reload:function(t,o){return t.each(function(){var t=e.data(this,"combotree").options,n=e.data(this,"combotree").tree;o&&(t.url=o),n.tree({url:t.url})})},setValues:function(t,o){return t.each(function(){var t=e(this).combotree("options");e.isArray(o)&&(o=e.map(o,function(o){return o&&"object"==typeof o?(e.easyui.addArrayItem(t.mappingRows,"id",o),o.id):o})),n(this,o)})},setValue:function(t,o){return t.each(function(){e(this).combotree("setValues",e.isArray(o)?o:[o])})},clear:function(t){return t.each(function(){e(this).combotree("setValues",[])})},reset:function(t){return t.each(function(){var t=e(this).combotree("options");t.multiple?e(this).combotree("setValues",t.originalValue):e(this).combotree("setValue",t.originalValue)})}},e.fn.combotree.parseOptions=function(t){return e.extend({},e.fn.combo.parseOptions(t),e.fn.tree.parseOptions(t))},e.fn.combotree.defaults=e.extend({},e.fn.combo.defaults,e.fn.tree.defaults,{editable:!1,textField:null,unselectedValues:[],mappingRows:[],keyHandler:{up:function(e){},down:function(e){},left:function(e){},right:function(e){},enter:function(e){i(this)},query:function(e,t){r(this,e)}}})}(jQuery);