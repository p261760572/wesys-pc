!function(o){function n(n,e){var i=o.data(n,"window");e&&(null!=e.left&&(i.options.left=e.left),null!=e.top&&(i.options.top=e.top)),o(n).panel("move",i.options),i.shadow&&i.shadow.css({left:i.options.left,top:i.options.top})}function e(e,i){var t=o.data(e,"window").options,d=o(e).window("panel"),a=d._outerWidth();if(t.inline){var s=d.parent();t.left=Math.ceil((s.width()-a)/2+s.scrollLeft())}else t.left=Math.ceil((o(window)._outerWidth()-a)/2+o(document).scrollLeft());i&&n(e)}function i(e,i){var t=o.data(e,"window").options,d=o(e).window("panel"),a=d._outerHeight();if(t.inline){var s=d.parent();t.top=Math.ceil((s.height()-a)/2+s.scrollTop())}else t.top=Math.ceil((o(window)._outerHeight()-a)/2+o(document).scrollTop());i&&n(e)}function t(t){var d=o.data(t,"window"),a=d.options,s=o(t).panel(o.extend({},d.options,{border:!1,doSize:!0,closed:!0,cls:"window "+(a.border?"thin"==a.border?"window-thinborder ":"":"window-thinborder window-noborder ")+(a.cls||""),headerCls:"window-header "+(a.headerCls||""),bodyCls:"window-body "+(a.noheader?"window-body-noheader ":" ")+(a.bodyCls||""),onBeforeDestroy:function(){if(0==a.onBeforeDestroy.call(t))return!1;d.shadow&&d.shadow.remove(),d.mask&&d.mask.remove()},onClose:function(){d.shadow&&d.shadow.hide(),d.mask&&d.mask.hide(),a.onClose.call(t)},onOpen:function(){d.mask&&d.mask.css(o.extend({display:"block",zIndex:o.fn.window.defaults.zIndex++},o.fn.window.getMaskSize(t))),d.shadow&&d.shadow.css({display:"block",zIndex:o.fn.window.defaults.zIndex++,left:a.left,top:a.top,width:d.window._outerWidth(),height:d.window._outerHeight()}),d.window.css("z-index",o.fn.window.defaults.zIndex++),a.onOpen.call(t)},onResize:function(n,e){var i=o(this).panel("options");o.extend(a,{width:i.width,height:i.height,left:i.left,top:i.top}),d.shadow&&d.shadow.css({left:a.left,top:a.top,width:d.window._outerWidth(),height:d.window._outerHeight()}),a.onResize.call(t,n,e)},onMinimize:function(){d.shadow&&d.shadow.hide(),d.mask&&d.mask.hide(),d.options.onMinimize.call(t)},onBeforeCollapse:function(){if(0==a.onBeforeCollapse.call(t))return!1;d.shadow&&d.shadow.hide()},onExpand:function(){d.shadow&&d.shadow.show(),a.onExpand.call(t)}}));d.window=s.panel("panel"),d.mask&&d.mask.remove(),a.modal&&(d.mask=o('<div class="window-mask" style="display:none"></div>').insertAfter(d.window)),d.shadow&&d.shadow.remove(),a.shadow&&(d.shadow=o('<div class="window-shadow" style="display:none"></div>').insertAfter(d.window));var w=a.closed;null==a.left&&e(t),null==a.top&&i(t),n(t),w||s.window("open")}function d(n,e,i,t){var d=this,a=o.data(d,"window"),s=a.options;if(!s.constrain)return{};if(o.isFunction(s.constrain))return s.constrain.call(d,n,e,i,t);var w=o(d).window("window"),l=s.inline?w.parent():o(window);return n<0&&(n=0),e<l.scrollTop()&&(e=l.scrollTop()),n+i>l.width()&&(i==w.outerWidth()?n=l.width()-i:i=l.width()-n),e-l.scrollTop()+t>l.height()&&(t==w.outerHeight()?e=l.height()-t+l.scrollTop():t=l.height()-e+l.scrollTop()),{left:n,top:e,width:i,height:t}}function a(n){function e(n){a.pmask&&a.pmask.remove(),a.pmask=o('<div class="window-proxy-mask"></div>').insertAfter(a.window),a.pmask.css({display:"none",zIndex:o.fn.window.defaults.zIndex++,left:n.data.left,top:n.data.top,width:a.window._outerWidth(),height:a.window._outerHeight()}),a.proxy&&a.proxy.remove(),a.proxy=o('<div class="window-proxy"></div>').insertAfter(a.window),a.proxy.css({display:"none",zIndex:o.fn.window.defaults.zIndex++,left:n.data.left,top:n.data.top}),a.proxy._outerWidth(n.data.width)._outerHeight(n.data.height),a.proxy.hide(),setTimeout(function(){a.pmask&&a.pmask.show(),a.proxy&&a.proxy.show()},500)}function i(e){o.extend(e.data,d.call(n,e.data.left,e.data.top,e.data.width,e.data.height)),a.pmask.show(),a.proxy.css({display:"block",left:e.data.left,top:e.data.top}),a.proxy._outerWidth(e.data.width),a.proxy._outerHeight(e.data.height)}function t(e,i){o.extend(e.data,d.call(n,e.data.left,e.data.top,e.data.width+.1,e.data.height+.1)),o(n).window(i,e.data),a.pmask.remove(),a.pmask=null,a.proxy.remove(),a.proxy=null}var a=o.data(n,"window");a.window.draggable({handle:">div.panel-header>div.panel-title",disabled:0==a.options.draggable,onBeforeDrag:function(n){a.mask&&a.mask.css("z-index",o.fn.window.defaults.zIndex++),a.shadow&&a.shadow.css("z-index",o.fn.window.defaults.zIndex++),a.window.css("z-index",o.fn.window.defaults.zIndex++)},onStartDrag:function(o){e(o)},onDrag:function(o){return i(o),!1},onStopDrag:function(o){t(o,"move")}}),a.window.resizable({disabled:0==a.options.resizable,onStartResize:function(o){e(o)},onResize:function(o){return i(o),!1},onStopResize:function(o){t(o,"resize")}})}o(function(){o._positionFixed||o(window).resize(function(){o("body>div.window-mask:visible").css({width:"",height:""}),setTimeout(function(){o("body>div.window-mask:visible").css(o.fn.window.getMaskSize())},50)})}),o.fn.window=function(n,e){if("string"==typeof n){var i=o.fn.window.methods[n];return i?i(this,e):this.panel(n,e)}return n=n||{},this.each(function(){var e=o.data(this,"window");e?o.extend(e.options,n):(e=o.data(this,"window",{options:o.extend({},o.fn.window.defaults,o.fn.window.parseOptions(this),n)}),e.options.inline||document.body.appendChild(this)),t(this),a(this)})},o.fn.window.methods={options:function(n){var e=n.panel("options"),i=o.data(n[0],"window").options;return o.extend(i,{closed:e.closed,collapsed:e.collapsed,minimized:e.minimized,maximized:e.maximized})},window:function(n){return o.data(n[0],"window").window},move:function(o,e){return o.each(function(){n(this,e)})},hcenter:function(o){return o.each(function(){e(this,!0)})},vcenter:function(o){return o.each(function(){i(this,!0)})},center:function(o){return o.each(function(){e(this),i(this),n(this)})}},o.fn.window.getMaskSize=function(n){var e=o(n).data("window");return e&&e.options.inline?{}:o._positionFixed?{position:"fixed"}:{width:o(document).width(),height:o(document).height()}},o.fn.window.parseOptions=function(n){return o.extend({},o.fn.panel.parseOptions(n),o.parser.parseOptions(n,[{draggable:"boolean",resizable:"boolean",shadow:"boolean",modal:"boolean",inline:"boolean"}]))},o.fn.window.defaults=o.extend({},o.fn.panel.defaults,{zIndex:9e3,draggable:!0,resizable:!0,shadow:!0,modal:!1,border:!0,inline:!1,title:"New Window",collapsible:!0,minimizable:!0,maximizable:!0,closable:!0,closed:!1,constrain:!1})}(jQuery);